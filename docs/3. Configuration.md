### Configuration ðŸ”§

To use Flowgger, you first need to define the flows of your application in `.stflow` files.

There are four type of logs. Flowgger expects you to define the appenders for each type:
- **Flows**
- **Head**
- **Data**
- **Error**

If an appender is not defined for a specific type, logging for that type will be skipped. Additionally, you can define filters to control logging to a particular appender using the `notFor` and `onlyFor` properties.

```javascript
const config = {
    "appenders": [
      {
        handler: flowsAppender,
        layout: lr => { // can be a function or object
          return `${lr.success},${lr.id},${lr.reportTime},${lr.flowName},${lr.steps}`;
        },
        onlyFor: {
          types: ["flows"],
          flows: ["second flow(2)", "first flow"]
        }
      },
      {
        handler: headAppender,
        layout: new CsvLayout(),
        onlyFor: {
          types: ["head"],
          flows: ["second flow(2)", "first flow"]
        }
      },
      {
        handler: dataAppender,
        // layout: logRecord => logRecord, // default
        onlyFor: {
          types: ["data", "error"],
          flows: ["second flow(2)", "first flow"]
        }
      },
      {
        handler: log4jsErrAppender,
        // layout: logRecord => logRecord, // default
        onlyFor: {
          types: ["error"],
          flows: ["second flow(1)"]
        }
      }
    ],
    flow: {
      source: path.resolve("./tests/flows"),
      // maxIdleTime: 200, // time difference between two consecutive steps
    }
};
```

---

### Properties and Terminologies Explained ðŸ”Ž

- **`handler`:**
  - The handler is an appender, which can be any object with an `append` method. Flowgger calls the `append` method to pass log records. An appender determines what to do with the log records, such as emailing errors, submitting them to Logstash or another aggregator, or generating alerts.

- **`layout`:**
  - The layout can be an object containing all logging methods (e.g., trace, info, debug, warn, error). Each method formats log records before they are logged to a stream. Alternatively, it can be a function that receives log records and log levels as input. Flowgger assigns the layout to the appenderâ€™s `layout` property.

- **`onlyFor`:**
  - Define conditions for when an appender should be used:
    - **`env`:** You can specify if you want to enable an appender for a particular environment.
    - **`types`:** Specify the log types (flows, head, data, error) the appender should handle.
    - **`flows`:** For applications with many flows, you can specify flows to monitor separately. For example, use this property to log a new featureâ€™s activity or track critical flows that require immediate attention.
    - **`keys`:** (currently not supported) Assign keys to debug statements. This allows enabling/disabling logs for specific keys at runtime. A dedicated appender can be used for verbose or noisy logs.

Note: If `onlyFor`, and `notFor` both filters are not specidifed or `types` are not defined then the appender will be used for all type of logs.

- **`notFor`:**
  - The inverse of `onlyFor`, with the same properties, specifying when the appender should not be used.

- **`flow.source`:**
  - Specifies the directory path containing `.stflow` files.

- **`flow.maxIdleTime`:**
  - Logs execution times for each step. Use this property to log execution times only when they exceed a defined threshold.

<small>You can have multiple flows with the same name by setting different `version` header to a flow in `.stflow` file. </small>
---

# Log properties

Flogger sets following properties for different type of logs

## flows

```
{
  success: true or false,
  id: an unique id,
  flowName: flow name with version,
  reportTime: flow start time,
  steps: an array of step index and execution time of each step, // [[stepid, duration],[]]
  errMsg: reason for marking a flow failed // when success is false
  parentFlowId: it is set only if current flow is called from another flow
  parentStepId: it is set only if current flow is called from another flow
}
```

## head

```
{
  id: an unique id,
  flowName: flow name with version,
  reportTime: flow start time,
  parentFlowId: it is set only if current flow is called from another flow
  parentStepId: it is set only if current flow is called from another flow
}
```

## debug or error

```
{
  id: an unique id,
  lastStepId: to determine the step after that extra info is added
  data: extra detail passed by user,
  reportTime: current time,
}
```

- `lastStepId` is set to -1 if the first step is wrong.